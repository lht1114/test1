<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="Access-Control-Allow-Origin" content="*">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1,user-scalable=no">
	<title>小程序跳转</title>
	<style>
		* {
			margin: 0;
		}
	</style>
</head>

<body>
	<wx-open-launch-weapp id="launch-btn" username="gh_83cfb273c5ff" path="pages/home/home">
		<!-- <script type="text/wxtag-template"> -->
			<style>
				.content { width: 100vw; text-align: center; }
			 .btn { padding: 15px 25px; margin-top: 150px; margin-left: 110px; font-size: 20px; background-color: #1F78E7; color: #ffffff; border: none; border-radius: 10px;}
			 </style>
			 <div class="content">
				<button class="btn">打开小程序</button>
			 </div>
		  </script>
	</wx-open-launch-weapp>
	<script>
		var btn = document.getElementById('launch-btn');
		btn.addEventListener('launch', function (e) {
			console.log('success');
		});
		btn.addEventListener('error', function (e) {
			console.log('fail', e.detail);
		});
	</script>
</body>

<script src="https://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
<script src="https://res2.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
<script type="text/javascript">
	$(function () {
		var url = encodeURIComponent(location.href.split("#")[0])
		$.ajax({
			type: "post",
			dataType: 'text',
			contentType: "application/x-www-form-urlencoded; charset=UTF-8",
			url: 'https://yszyb.ysepay.com/zyb_interface/weChatPaymentAction/jsapiSign.action?url=' + url,
			data: {
				url: url
			},
			success: (res) => {
				var data = JSON.parse(res)
				console.log(data)
				wx.config({
					debug: false,
					appId: data.appId,
					timestamp: data.timestamp,
					nonceStr: data.nonceStr,
					signature: data.signature,
					jsApiList: ['scanQRCode', 'chooseImage', 'getLocalImgData', 'getLocation'],//必须要 不调用小程序标签渲染不出来
					openTagList: ['wx-open-launch-weapp']
				});
				wx.ready(function () {
					console.log('成功')
				})
				wx.error(function () {
					console.log('失败')
				})
			}

		})
	})
</script>

</html>
